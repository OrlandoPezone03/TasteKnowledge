<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Page</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/assets/logo.svg">
    <link rel="stylesheet" href="/pages/css/recipePage.css">
    <!-- Bootstrap Icons library -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
    <!-- Main application wrapper -->
    <div class="app-container">

         <!-- Top header with recipe image -->
        <div class="hero">
            <img id="recipe-hero-img" class="recipe-hero-image" src="" alt="Recipe image">
            <div class="hero-overlay">
                <button class="icon-btn back-btn"><i class="bi bi-chevron-left"></i></button>
                <button class="icon-btn bookmark-btn"><i class="bi bi-heart"></i></button>
            </div>
        </div>

        <div class="content-grid">

            <aside class="sidebar">
                <div>
                    <!-- Recipe title loaded dynamically -->
                    <h1 id="recipe-title">Loading...</h1>
                    <div class="author-row">
                        <img id="chef-avatar" src="" alt="Chef" class="avatar">
                        <span class="author-name" id="chef-name">Loading...</span>
                    </div>
                    <div class="meta-info">
                        <span id="recipe-time"><i class="bi bi-clock"></i> -- </span>
                        <span class="rating-value" id="recipe-rating"><i class="bi bi-star-fill"></i> 0</span>
                    </div>
                </div>

                <div class="description" id="recipe-description">Loading description...</div>

                <!-- Nutrition widget -->
                <div class="nutrition-widget">
                    <h4>Nutrition Facts</h4>
                    <div class="nutrition-container">
                        <div class="donut-chart">
                            <div class="donut-inner">
                                <span class="cal-count" id="recipe-calories">--</span>
                                <span class="cal-label">Kcal</span>
                            </div>
                        </div>
                        <div class="nutri-list">
                            <div class="nutrient-protein" id="recipe-protein">Protein: -- g</div>
                            <div class="nutrient-carbs" id="recipe-carbs">Carbs: -- g</div>
                            <div class="nutrient-fats" id="recipe-fats">Fats: -- g</div>
                        </div>
                    </div>
                </div>

            </aside>

            <main class="main-content">

                <!-- Tab navigation -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('ingredients')" id="btn-ingredients">Ingredients</button>
                    <button class="tab-btn" onclick="switchTab('science')" id="btn-science">The Science</button>
                </div>

                <div id="view-ingredients" class="section-view active">
                    <!-- Ingredients loaded via JS -->
                    <div class="ingredient-grid" id="ingredient-list"></div>

                    <!-- Recipe preparation steps -->
                    <h3>Preparation Steps</h3>
                    <div id="steps-container"><!-- Steps loaded via JS --></div>
                </div>

                <div id="view-science" class="section-view">
                    <h3>Why this recipe works</h3>
                    <div id="science-container"><!-- Scientific notes loaded dynamically --></div>
                </div>

                <!-- Comments area -->
                <div class="comments-section">
                    <h3>Community Comments</h3>

                    <div class="comment-form-container">
                        <!-- Shown to non-authenticated users -->
                        <p class="login-prompt" style="display:none;">Login to comment</p>

                        <!-- Comment input + star rating (visible when logged in) -->
                        <form class="comment-form" style="display:none;" onsubmit="event.preventDefault(); addComment();">
                            
                            <!-- Star rating selector -->
                            <div class="rating-stars" role="radiogroup">
                                <span class="star" data-value="1" tabindex="0"><i class="bi bi-star"></i></span>
                                <span class="star" data-value="2" tabindex="0"><i class="bi bi-star"></i></span>
                                <span class="star" data-value="3" tabindex="0"><i class="bi bi-star"></i></span>
                                <span class="star" data-value="4" tabindex="0"><i class="bi bi-star"></i></span>
                                <span class="star" data-value="5" tabindex="0"><i class="bi bi-star"></i></span>
                            </div>

                            <div class="comment-input-row">
                                <input type="text" class="comment-input" placeholder="Write a comment..." id="userInput">
                                <button class="send-btn" type="submit" id="sendCommentBtn">Send</button>
                            </div>
                        </form>
                    </div>

                    <div id="comment-list"><!-- Comments loaded by JS --></div>
                </div>
            </main>
        </div>
    </div>

    <!-- ChefBot button -->
    <div class="chefbot-container">
        <div class="chefbot-badge">Need help?</div>
        <div class="chefbot-circle" title="Ask ChefBot for help" role="button" tabindex="0">
            <img src="/assets/chefBotIcon.svg" alt="chefBotIcon">
        </div>
    </div>

    <!-- ChefBot Modal -->
    <div id="chefbot-modal" class="modal hidden" aria-hidden="true">
        <div class="modal-header">
            <h3>Chef Bot Assistant</h3>
            <button class="modal-close" aria-label="Close"><i class="bi bi-x"></i></button>
        </div>

        <div class="modal-body">
            <div class="chat-container" id="chefbotModalChat">
                <!-- Chat messages will be appended here by client-side JS. -->
            </div>

            <div class="input-container">
                <textarea id="chefbotModalInput" placeholder="Ask something about the recipe..." rows="1"></textarea>
                <button id="chefbotModalSend">Send</button>
            </div>
        </div>
    </div>

    <!-- TODO: Add chefBot.js and recipePage.js -->
</body>
</html>